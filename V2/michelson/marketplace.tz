{ parameter
    (or (or (or (or (or (pair %acceptCounterOffer
                           (nat %token_id)
                           (address %seller)
                           (address %token_origin))
                        (pair %acceptOffer
                           (address %buyer)
                           (nat %token_id)
                           (string %token_symbol)
                           (address %token_origin)))
                    (or (string %addSingleToken)
                        (pair %addToMarketplace
                           (or %swap_type (pair %dutch (nat %starting_price) (nat %duration)) (unit %regular))
                           (nat %token_id)
                           (nat %token_price)
                           (timestamp %start_time)
                           (timestamp %end_time)
                           (nat %token_amount)
                           (address %token_origin)
                           (or %recipient (unit %general) (address %reserved))
                           (string %token_symbol)
                           (set %accepted_tokens string)
                           (bool %is_multi_token))))
                (or (or (pair %collect
                           (nat %swap_id)
                           (nat %token_amount)
                           (string %token_symbol)
                           (nat %amount_ft))
                        (pair %makeCounterOffer
                           (nat %token_id)
                           (address %buyer)
                           (timestamp %start_time)
                           (timestamp %end_time)
                           (string %token_symbol)
                           (nat %ft_amount)
                           (address %token_origin)))
                    (or (pair %mintNft
                           (string %metadata_url)
                           (nat %royalties)
                           (nat %amount_)
                           (address %owner))
                        (nat %removeFromMarketplace))))
            (or (or (or (string %removeSingleToken)
                        (pair %sendOffer
                           (nat %token_amount)
                           (nat %token_id)
                           (timestamp %start_time)
                           (timestamp %end_time)
                           (address %token_origin)
                           (string %token_symbol)
                           (nat %ft_amount)))
                    (or (address %updateAdmin)
                        (pair %updateAllowedTokens
                           (string %token_symbol)
                           (or %direction (address %add_token) (unit %remove_token)))))
                (or (or (nat %updateFee) (address %updateNftAddress))
                    (or (pair %updateOffer
                           (nat %token_amount)
                           (nat %token_id)
                           (timestamp %start_time)
                           (timestamp %end_time)
                           (address %token_origin)
                           (string %token_symbol)
                           (nat %ft_amount))
                        (address %updateOracleAddress)))))
        (or (or (or (pair %updateRoyalties (nat %token_id) (address %token_origin) (nat %royalties))
                    (address %updateRoyaltiesAddress))
                (or (pair %updateSwap
                       (nat %swap_id)
                       (or %action
                          (or (or (nat %add_amount) (nat %reduce_amount))
                              (or (nat %update_duration) (nat %update_price)))
                          (or (or (address %update_reserved_address) (nat %update_starting_price))
                              (pair %update_times (timestamp %start_time) (timestamp %end_time)))))
                    (pair %withdrawCounterOffer
                       (nat %token_id)
                       (address %buyer)
                       (address %token_origin))))
            (pair %withdrawOffer (nat %token_id) (address %token_origin)))) ;
  storage
    (pair (address %nft_address)
          (address %royalties_address)
          (nat %next_swap_id)
          (nat %next_token_id)
          (big_map %tokens (pair nat address) nat)
          (big_map %counter_offers
             (pair (nat %token_id) (address %buyer) (address %seller) (address %token_origin))
             (pair (pair (pair (timestamp %end_time) (nat %ft_amount))
                         (address %owner)
                         (timestamp %start_time))
                   (string %token_symbol)))
          (big_map %swaps
             nat
             (pair (address %owner)
                   (nat %token_id)
                   (bool %is_dutch)
                   (bool %is_reserved)
                   (nat %starting_price)
                   (nat %token_price)
                   (timestamp %start_time)
                   (int %duration)
                   (timestamp %end_time)
                   (nat %token_amount)
                   (address %origin)
                   (address %recipient)
                   (set %accepted_tokens string)
                   (string %ft_symbol)
                   (bool %is_multi_token)))
          (big_map %offers
             (pair (nat %token_id) (address %buyer) (address %token_origin))
             (pair (nat %token_amount)
                   (nat %value)
                   (timestamp %start_time)
                   (timestamp %end_time)
                   (address %origin)
                   (string %token_symbol)))
          (nat %management_fee_rate)
          (bool %paused)
          (big_map %allowed_tokens
             string
             (pair (string %token_symbol) (address %fa12_address)))
          (big_map %available_pairs (pair string string) string)
          (set %single_tokens string)
          (address %oracle)
          (address %admin)
          (address %treasury)) ;
  code { LAMBDA
           (pair (list operation) nat string address address address)
           (list operation)
           { UNPAIR 6 ;
             PUSH nat 0 ;
             DUP 3 ;
             COMPARE ;
             GT ;
             IF { DUP 6 ;
                  CONTRACT %deposit
                    (pair (string %token) (address %fa12_address) (nat %token_amount)) ;
                  IF_NONE
                    { DROP 6 ; PUSH string "wrong treasury contract" ; FAILWITH }
                    { DUP 3 ;
                      DUP 6 ;
                      DUP 6 ;
                      PAIR 3 ;
                      PUSH string "XTZ" ;
                      DIG 5 ;
                      COMPARE ;
                      EQ ;
                      IF { DIG 4 ;
                           DIG 5 ;
                           DIG 6 ;
                           DROP 3 ;
                           DUG 2 ;
                           PUSH mutez 1 ;
                           DIG 4 ;
                           MUL ;
                           DIG 3 ;
                           PAIR 3 ;
                           UNPAIR 3 ;
                           TRANSFER_TOKENS }
                         { DIG 2 ;
                           DIG 4 ;
                           CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                           IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                           PUSH mutez 0 ;
                           DIG 5 ;
                           DIG 7 ;
                           DIG 7 ;
                           PAIR 3 ;
                           TRANSFER_TOKENS ;
                           CONS ;
                           DIG 2 ;
                           PUSH mutez 0 ;
                           DIG 3 ;
                           TRANSFER_TOKENS } ;
                      CONS } }
                { SWAP ; DIG 2 ; DIG 3 ; DIG 4 ; DIG 5 ; DROP 5 } } ;
         LAMBDA
           (pair string
                 address
                 address
                 nat
                 nat
                 (big_map (pair nat address) nat)
                 (big_map
                    (pair nat address address address)
                    (pair (pair (pair timestamp nat) address timestamp) string))
                 (big_map
                    nat
                    (pair address
                          nat
                          bool
                          bool
                          nat
                          nat
                          timestamp
                          int
                          timestamp
                          nat
                          address
                          address
                          (set string)
                          string
                          bool))
                 (big_map
                    (pair nat address address)
                    (pair nat nat timestamp timestamp address string))
                 nat
                 bool
                 (big_map string (pair string address))
                 (big_map (pair string string) string)
                 (set string)
                 address
                 address
                 address)
           address
           { UNPAIR ;
             SWAP ;
             GET 21 ;
             SWAP ;
             GET ;
             IF_NONE { PUSH nat 131 ; FAILWITH } { CDR } } ;
         DIG 2 ;
         UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { IF_LEFT
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 4 ; PUSH nat 117 ; FAILWITH }
                                { DUP ;
                                  GET 4 ;
                                  SENDER ;
                                  DUP 3 ;
                                  CAR ;
                                  PAIR 3 ;
                                  DUP 2 ;
                                  GET 4 ;
                                  DUP 3 ;
                                  GET 3 ;
                                  SENDER ;
                                  DUP 5 ;
                                  CAR ;
                                  PAIR 4 ;
                                  DUP 4 ;
                                  GET 15 ;
                                  DUP 3 ;
                                  GET ;
                                  IF_NONE
                                    { SWAP ; DROP ; PUSH nat 116 ; FAILWITH }
                                    { DUP 5 ;
                                      GET 15 ;
                                      NONE (pair nat nat timestamp timestamp address string) ;
                                      DIG 4 ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR } ;
                                  UNPAIR ;
                                  DUP 5 ;
                                  GET 11 ;
                                  DUP 4 ;
                                  GET ;
                                  IF_NONE
                                    { DIG 2 ; DROP ; PUSH nat 141 ; FAILWITH }
                                    { DUP 6 ;
                                      GET 11 ;
                                      NONE (pair (pair (pair timestamp nat) address timestamp) string) ;
                                      DIG 5 ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR } ;
                                  UNPAIR ;
                                  DUP ;
                                  CAR ;
                                  CDR ;
                                  CDR ;
                                  NOW ;
                                  COMPARE ;
                                  LT ;
                                  IF { DROP 8 ; PUSH nat 143 ; FAILWITH }
                                     { DUP ;
                                       CAR ;
                                       CAR ;
                                       CAR ;
                                       NOW ;
                                       COMPARE ;
                                       GT ;
                                       IF { DROP 8 ; PUSH nat 144 ; FAILWITH }
                                          { DUP ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            AMOUNT ;
                                            PUSH mutez 1 ;
                                            SWAP ;
                                            EDIV ;
                                            IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                            CAR ;
                                            COMPARE ;
                                            NEQ ;
                                            PUSH string "XTZ" ;
                                            DUP 3 ;
                                            CDR ;
                                            COMPARE ;
                                            EQ ;
                                            AND ;
                                            IF { DROP 8 ; PUSH nat 114 ; FAILWITH }
                                               { NIL operation ;
                                                 PUSH string "XTZ" ;
                                                 DUP 5 ;
                                                 GET 10 ;
                                                 COMPARE ;
                                                 EQ ;
                                                 IF { PUSH mutez 1 ;
                                                      DUP 5 ;
                                                      GET 3 ;
                                                      MUL ;
                                                      SENDER ;
                                                      CONTRACT unit ;
                                                      IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                      SWAP ;
                                                      UNIT ;
                                                      TRANSFER_TOKENS }
                                                    { DUP 7 ;
                                                      DUP 5 ;
                                                      GET 10 ;
                                                      PAIR ;
                                                      DUP 9 ;
                                                      SWAP ;
                                                      EXEC ;
                                                      SWAP ;
                                                      DUP 5 ;
                                                      GET 3 ;
                                                      SENDER ;
                                                      SELF_ADDRESS ;
                                                      DIG 4 ;
                                                      PAIR 4 ;
                                                      UNPAIR 4 ;
                                                      CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                      IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                      PUSH mutez 0 ;
                                                      DIG 4 ;
                                                      DIG 4 ;
                                                      DIG 4 ;
                                                      PAIR 3 ;
                                                      TRANSFER_TOKENS } ;
                                                 CONS ;
                                                 DUP 7 ;
                                                 CAR ;
                                                 DUP 5 ;
                                                 GET 9 ;
                                                 COMPARE ;
                                                 NEQ ;
                                                 IF { PUSH nat 0 ; SELF_ADDRESS ; PAIR }
                                                    { DUP 7 ;
                                                      GET 3 ;
                                                      DUP 7 ;
                                                      CAR ;
                                                      VIEW "get_royalties" (pair (address %issuer) (nat %royalties)) ;
                                                      IF_NONE { PUSH string "no royalties" ; FAILWITH } {} } ;
                                                 PUSH nat 10000 ;
                                                 DUP 9 ;
                                                 GET 17 ;
                                                 DUP 5 ;
                                                 CAR ;
                                                 CAR ;
                                                 CDR ;
                                                 MUL ;
                                                 EDIV ;
                                                 IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                 CAR ;
                                                 PUSH nat 10000 ;
                                                 DUP 5 ;
                                                 CAR ;
                                                 CAR ;
                                                 CDR ;
                                                 DUP 4 ;
                                                 CDR ;
                                                 MUL ;
                                                 EDIV ;
                                                 IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                 CAR ;
                                                 DUP ;
                                                 DUP 3 ;
                                                 ADD ;
                                                 DUP 6 ;
                                                 CAR ;
                                                 CAR ;
                                                 CDR ;
                                                 SUB ;
                                                 ISNAT ;
                                                 IF_NONE { PUSH nat 105 ; FAILWITH } {} ;
                                                 DIG 4 ;
                                                 NIL (pair address (list (pair address nat nat))) ;
                                                 NIL (pair address nat nat) ;
                                                 DUP 10 ;
                                                 CAR ;
                                                 DUP 13 ;
                                                 CAR ;
                                                 SENDER ;
                                                 PAIR 3 ;
                                                 CONS ;
                                                 SELF_ADDRESS ;
                                                 PAIR ;
                                                 CONS ;
                                                 DIG 8 ;
                                                 GET 9 ;
                                                 CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                                 IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                                 SWAP ;
                                                 MAP { DUP ;
                                                       CDR ;
                                                       MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                       SWAP ;
                                                       CAR ;
                                                       PAIR } ;
                                                 SWAP ;
                                                 PUSH mutez 0 ;
                                                 DIG 2 ;
                                                 TRANSFER_TOKENS ;
                                                 CONS ;
                                                 DUP 10 ;
                                                 DUP 7 ;
                                                 CDR ;
                                                 PAIR ;
                                                 DIG 11 ;
                                                 SWAP ;
                                                 EXEC ;
                                                 DIG 9 ;
                                                 GET 3 ;
                                                 SENDER ;
                                                 DUP 3 ;
                                                 DUP 10 ;
                                                 CDR ;
                                                 DIG 6 ;
                                                 DIG 6 ;
                                                 PAIR 6 ;
                                                 UNPAIR 6 ;
                                                 PUSH nat 0 ;
                                                 DUP 3 ;
                                                 COMPARE ;
                                                 GT ;
                                                 IF { PUSH string "XTZ" ;
                                                      DIG 3 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { DIG 2 ;
                                                           DIG 3 ;
                                                           DROP 2 ;
                                                           PUSH mutez 1 ;
                                                           DIG 2 ;
                                                           MUL ;
                                                           DIG 2 ;
                                                           CONTRACT unit ;
                                                           IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                           SWAP ;
                                                           UNIT ;
                                                           TRANSFER_TOKENS }
                                                         { DIG 2 ;
                                                           CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                           IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                           PUSH mutez 0 ;
                                                           DIG 3 ;
                                                           DIG 5 ;
                                                           DIG 5 ;
                                                           PAIR 3 ;
                                                           TRANSFER_TOKENS } ;
                                                      CONS }
                                                    { SWAP ; DIG 2 ; DIG 3 ; DIG 4 ; DIG 5 ; DROP 5 } ;
                                                 DIG 4 ;
                                                 CAR ;
                                                 SENDER ;
                                                 DUP 4 ;
                                                 DUP 8 ;
                                                 CDR ;
                                                 DIG 6 ;
                                                 DIG 5 ;
                                                 PAIR 6 ;
                                                 UNPAIR 6 ;
                                                 PUSH nat 0 ;
                                                 DUP 3 ;
                                                 COMPARE ;
                                                 GT ;
                                                 IF { PUSH string "XTZ" ;
                                                      DIG 3 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { DIG 2 ;
                                                           DIG 3 ;
                                                           DROP 2 ;
                                                           PUSH mutez 1 ;
                                                           DIG 2 ;
                                                           MUL ;
                                                           DIG 2 ;
                                                           CONTRACT unit ;
                                                           IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                           SWAP ;
                                                           UNIT ;
                                                           TRANSFER_TOKENS }
                                                         { DIG 2 ;
                                                           CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                           IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                           PUSH mutez 0 ;
                                                           DIG 3 ;
                                                           DIG 5 ;
                                                           DIG 5 ;
                                                           PAIR 3 ;
                                                           TRANSFER_TOKENS } ;
                                                      CONS }
                                                    { SWAP ; DIG 2 ; DIG 3 ; DIG 4 ; DIG 5 ; DROP 5 } ;
                                                 DUP 7 ;
                                                 GET 30 ;
                                                 SENDER ;
                                                 DIG 3 ;
                                                 DIG 5 ;
                                                 CDR ;
                                                 DIG 5 ;
                                                 DIG 5 ;
                                                 PAIR 6 ;
                                                 DIG 4 ;
                                                 SWAP ;
                                                 EXEC ;
                                                 DIG 3 ;
                                                 DIG 3 ;
                                                 UPDATE 15 ;
                                                 DIG 2 ;
                                                 UPDATE 11 ;
                                                 SWAP ;
                                                 PAIR } } } } }
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 4 ; PUSH nat 117 ; FAILWITH }
                                { DUP ;
                                  GET 3 ;
                                  DUP 2 ;
                                  CAR ;
                                  SENDER ;
                                  DIG 3 ;
                                  GET 6 ;
                                  DUP 3 ;
                                  DUP 5 ;
                                  PAIR 3 ;
                                  DUP 5 ;
                                  GET 15 ;
                                  DUP 2 ;
                                  GET ;
                                  IF_NONE { PUSH nat 113 ; FAILWITH } {} ;
                                  DUP ;
                                  GET 5 ;
                                  NOW ;
                                  COMPARE ;
                                  LT ;
                                  IF { DROP 8 ; PUSH nat 111 ; FAILWITH }
                                     { DUP ;
                                       GET 7 ;
                                       NOW ;
                                       COMPARE ;
                                       GT ;
                                       IF { DROP 8 ; PUSH nat 112 ; FAILWITH }
                                          { DUP 6 ;
                                            CAR ;
                                            DUP 2 ;
                                            GET 9 ;
                                            COMPARE ;
                                            NEQ ;
                                            IF { PUSH nat 0 ; SELF_ADDRESS ; PAIR }
                                               { DUP 6 ;
                                                 GET 3 ;
                                                 DUP 6 ;
                                                 VIEW "get_royalties" (pair (address %issuer) (nat %royalties)) ;
                                                 IF_NONE { PUSH string "no royalties" ; FAILWITH } {} } ;
                                            DUP 2 ;
                                            CAR ;
                                            PUSH nat 10000 ;
                                            DUP 9 ;
                                            GET 17 ;
                                            DUP 5 ;
                                            GET 3 ;
                                            MUL ;
                                            EDIV ;
                                            IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                            CAR ;
                                            PUSH nat 10000 ;
                                            DUP 5 ;
                                            GET 3 ;
                                            DUP 5 ;
                                            CDR ;
                                            MUL ;
                                            EDIV ;
                                            IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                            CAR ;
                                            DUP ;
                                            DUP 3 ;
                                            ADD ;
                                            DUP 6 ;
                                            GET 3 ;
                                            SUB ;
                                            ISNAT ;
                                            IF_NONE { PUSH nat 105 ; FAILWITH } {} ;
                                            DUP 11 ;
                                            GET 9 ;
                                            DUP 9 ;
                                            DUP 12 ;
                                            PAIR ;
                                            GET ;
                                            IF_NONE { PUSH nat 1 ; DUP 12 ; GET 5 ; ADD } {} ;
                                            DUP 12 ;
                                            GET 13 ;
                                            DUP 2 ;
                                            GET ;
                                            IF_NONE
                                              { PUSH bool False ;
                                                DUP 8 ;
                                                GET 10 ;
                                                EMPTY_SET string ;
                                                SELF_ADDRESS ;
                                                DUP 11 ;
                                                GET 9 ;
                                                PUSH nat 0 ;
                                                NOW ;
                                                PUSH int 0 ;
                                                NOW ;
                                                PUSH nat 0 ;
                                                PUSH nat 0 ;
                                                PUSH bool False ;
                                                PUSH bool False ;
                                                PUSH nat 0 ;
                                                SELF_ADDRESS ;
                                                PAIR 15 }
                                              {} ;
                                            DUP 10 ;
                                            SOURCE ;
                                            COMPARE ;
                                            NEQ ;
                                            DUP 2 ;
                                            CAR ;
                                            SOURCE ;
                                            COMPARE ;
                                            NEQ ;
                                            AND ;
                                            IF { DROP 15 ; PUSH nat 125 ; FAILWITH }
                                               { DUP 6 ;
                                                 DUP 2 ;
                                                 GET 19 ;
                                                 SUB ;
                                                 ISNAT ;
                                                 IF_NONE
                                                   { DUP 13 ;
                                                     GET 9 ;
                                                     NONE nat ;
                                                     DUP 12 ;
                                                     DUP 15 ;
                                                     PAIR ;
                                                     UPDATE ;
                                                     DUP 14 ;
                                                     GET 13 ;
                                                     NONE (pair address
                                                                nat
                                                                bool
                                                                bool
                                                                nat
                                                                nat
                                                                timestamp
                                                                int
                                                                timestamp
                                                                nat
                                                                address
                                                                address
                                                                (set string)
                                                                string
                                                                bool) ;
                                                     DIG 4 ;
                                                     UPDATE ;
                                                     PAIR ;
                                                     DUP 2 ;
                                                     GET 19 ;
                                                     DIG 6 ;
                                                     SUB ;
                                                     ABS ;
                                                     DIG 2 ;
                                                     GET 19 }
                                                   { PUSH nat 0 ;
                                                     DUP 2 ;
                                                     COMPARE ;
                                                     EQ ;
                                                     IF { DUP 14 ;
                                                          GET 9 ;
                                                          PUSH nat 0 ;
                                                          DUP 3 ;
                                                          COMPARE ;
                                                          EQ ;
                                                          IF { NONE nat } { DUP 2 ; SOME } ;
                                                          DUP 13 ;
                                                          DUP 16 ;
                                                          PAIR ;
                                                          UPDATE ;
                                                          DUP 15 ;
                                                          GET 13 ;
                                                          PUSH nat 0 ;
                                                          DUP 4 ;
                                                          COMPARE ;
                                                          EQ ;
                                                          IF { DIG 2 ;
                                                               DIG 3 ;
                                                               DROP 2 ;
                                                               NONE (pair address
                                                                          nat
                                                                          bool
                                                                          bool
                                                                          nat
                                                                          nat
                                                                          timestamp
                                                                          int
                                                                          timestamp
                                                                          nat
                                                                          address
                                                                          address
                                                                          (set string)
                                                                          string
                                                                          bool) }
                                                             { DIG 3 ; DIG 3 ; UPDATE 19 ; SOME } ;
                                                          DIG 3 ;
                                                          UPDATE ;
                                                          PAIR ;
                                                          PUSH nat 0 }
                                                        { DUP 14 ;
                                                          GET 9 ;
                                                          DUP 15 ;
                                                          GET 13 ;
                                                          DIG 3 ;
                                                          DIG 3 ;
                                                          UPDATE 19 ;
                                                          SOME ;
                                                          DIG 3 ;
                                                          UPDATE ;
                                                          PAIR ;
                                                          PUSH nat 0 } ;
                                                     DIG 5 } ;
                                                 DIG 2 ;
                                                 UNPAIR ;
                                                 NIL (pair address (list (pair address nat nat))) ;
                                                 PUSH nat 0 ;
                                                 DUP 6 ;
                                                 COMPARE ;
                                                 GT ;
                                                 IF { NIL (pair address nat nat) ;
                                                      DIG 5 ;
                                                      DUP 15 ;
                                                      DUP 15 ;
                                                      PAIR 3 ;
                                                      CONS ;
                                                      DUP 12 ;
                                                      PAIR ;
                                                      CONS }
                                                    { DIG 4 ; DROP } ;
                                                 PUSH nat 0 ;
                                                 DUP 5 ;
                                                 COMPARE ;
                                                 GT ;
                                                 IF { NIL (pair address nat nat) ;
                                                      DIG 4 ;
                                                      DIG 13 ;
                                                      DIG 13 ;
                                                      PAIR 3 ;
                                                      CONS ;
                                                      SELF_ADDRESS ;
                                                      PAIR ;
                                                      CONS }
                                                    { DIG 3 ; DIG 11 ; DIG 12 ; DROP 3 } ;
                                                 NIL operation ;
                                                 DUP 9 ;
                                                 GET 9 ;
                                                 CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                                 IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                                 DIG 2 ;
                                                 MAP { DUP ;
                                                       CDR ;
                                                       MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                       SWAP ;
                                                       CAR ;
                                                       PAIR } ;
                                                 SWAP ;
                                                 PUSH mutez 0 ;
                                                 DIG 2 ;
                                                 TRANSFER_TOKENS ;
                                                 CONS ;
                                                 DUP 11 ;
                                                 DUP 9 ;
                                                 GET 10 ;
                                                 PAIR ;
                                                 DIG 12 ;
                                                 SWAP ;
                                                 EXEC ;
                                                 DIG 10 ;
                                                 SELF_ADDRESS ;
                                                 DUP 3 ;
                                                 DUP 12 ;
                                                 GET 10 ;
                                                 DIG 8 ;
                                                 DIG 6 ;
                                                 PAIR 6 ;
                                                 UNPAIR 6 ;
                                                 PUSH nat 0 ;
                                                 DUP 3 ;
                                                 COMPARE ;
                                                 GT ;
                                                 IF { PUSH string "XTZ" ;
                                                      DIG 3 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { DIG 2 ;
                                                           DIG 3 ;
                                                           DROP 2 ;
                                                           PUSH mutez 1 ;
                                                           DIG 2 ;
                                                           MUL ;
                                                           DIG 2 ;
                                                           CONTRACT unit ;
                                                           IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                           SWAP ;
                                                           UNIT ;
                                                           TRANSFER_TOKENS }
                                                         { DIG 2 ;
                                                           CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                           IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                           PUSH mutez 0 ;
                                                           DIG 3 ;
                                                           DIG 5 ;
                                                           DIG 5 ;
                                                           PAIR 3 ;
                                                           TRANSFER_TOKENS } ;
                                                      CONS }
                                                    { SWAP ; DIG 2 ; DIG 3 ; DIG 4 ; DIG 5 ; DROP 5 } ;
                                                 DIG 6 ;
                                                 CAR ;
                                                 SELF_ADDRESS ;
                                                 DUP 4 ;
                                                 DUP 10 ;
                                                 GET 10 ;
                                                 DIG 8 ;
                                                 DIG 5 ;
                                                 PAIR 6 ;
                                                 UNPAIR 6 ;
                                                 PUSH nat 0 ;
                                                 DUP 3 ;
                                                 COMPARE ;
                                                 GT ;
                                                 IF { PUSH string "XTZ" ;
                                                      DIG 3 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { DIG 2 ;
                                                           DIG 3 ;
                                                           DROP 2 ;
                                                           PUSH mutez 1 ;
                                                           DIG 2 ;
                                                           MUL ;
                                                           DIG 2 ;
                                                           CONTRACT unit ;
                                                           IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                           SWAP ;
                                                           UNIT ;
                                                           TRANSFER_TOKENS }
                                                         { DIG 2 ;
                                                           CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                           IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                           PUSH mutez 0 ;
                                                           DIG 3 ;
                                                           DIG 5 ;
                                                           DIG 5 ;
                                                           PAIR 3 ;
                                                           TRANSFER_TOKENS } ;
                                                      CONS }
                                                    { SWAP ; DIG 2 ; DIG 3 ; DIG 4 ; DIG 5 ; DROP 5 } ;
                                                 DUP 8 ;
                                                 GET 30 ;
                                                 SELF_ADDRESS ;
                                                 DIG 3 ;
                                                 DIG 7 ;
                                                 GET 10 ;
                                                 DIG 7 ;
                                                 DIG 5 ;
                                                 PAIR 6 ;
                                                 DIG 5 ;
                                                 SWAP ;
                                                 EXEC ;
                                                 DUP 5 ;
                                                 DIG 5 ;
                                                 GET 15 ;
                                                 NONE (pair nat nat timestamp timestamp address string) ;
                                                 DIG 6 ;
                                                 UPDATE ;
                                                 UPDATE 15 ;
                                                 DIG 2 ;
                                                 UPDATE 13 ;
                                                 DIG 2 ;
                                                 UPDATE 9 ;
                                                 SWAP ;
                                                 PAIR } } } } } }
                       { DIG 2 ;
                         DIG 3 ;
                         DROP 2 ;
                         IF_LEFT
                           { DUP 2 ;
                             GET 29 ;
                             SENDER ;
                             COMPARE ;
                             NEQ ;
                             IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                                { DUP 2 ;
                                  DIG 2 ;
                                  GET 25 ;
                                  DIG 2 ;
                                  PUSH bool True ;
                                  SWAP ;
                                  UPDATE ;
                                  UPDATE 25 ;
                                  NIL operation ;
                                  PAIR } }
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                                { DUP 2 ;
                                  GET 9 ;
                                  SENDER ;
                                  DUP 3 ;
                                  GET 3 ;
                                  PAIR ;
                                  GET ;
                                  IF_NONE { DUP 2 ; GET 5 } { DROP ; PUSH nat 118 ; FAILWITH } ;
                                  DUP 2 ;
                                  GET 9 ;
                                  DUP 3 ;
                                  GET 7 ;
                                  COMPARE ;
                                  GE ;
                                  IF { DROP 3 ; PUSH nat 120 ; FAILWITH }
                                     { DUP 3 ;
                                       GET 25 ;
                                       DUP 3 ;
                                       GET 17 ;
                                       MEM ;
                                       NOT ;
                                       DUP 3 ;
                                       GET 20 ;
                                       NOT ;
                                       AND ;
                                       IF { DROP 3 ; PUSH nat 149 ; FAILWITH }
                                          { DUP 2 ;
                                            GET 19 ;
                                            ITER { PUSH nat 134 ;
                                                   DUP 5 ;
                                                   GET 21 ;
                                                   DIG 2 ;
                                                   MEM ;
                                                   NOT ;
                                                   IF { FAILWITH } { DROP } } ;
                                            DUP 3 ;
                                            GET 21 ;
                                            DUP 3 ;
                                            GET 17 ;
                                            GET ;
                                            IF_NONE { PUSH nat 131 ; FAILWITH } { CAR } ;
                                            DUP 3 ;
                                            CAR ;
                                            IF_LEFT
                                              { DUP 4 ;
                                                GET 7 ;
                                                DUP 5 ;
                                                GET 9 ;
                                                SUB ;
                                                DUP 2 ;
                                                CDR ;
                                                INT ;
                                                COMPARE ;
                                                GT ;
                                                IF { DROP ; PUSH nat 127 ; FAILWITH }
                                                   { PUSH bool True ; DUP 2 ; CDR ; INT ; DIG 2 ; CAR ; PAIR ; PAIR } }
                                              { DROP ; PUSH bool False ; PUSH int 0 ; DUP 5 ; GET 5 ; PAIR ; PAIR } ;
                                            UNPAIR ;
                                            UNPAIR ;
                                            DUP 6 ;
                                            GET 15 ;
                                            IF_LEFT
                                              { DROP ; PUSH bool False ; SELF_ADDRESS }
                                              { PUSH bool True ; SWAP } ;
                                            PUSH nat 0 ;
                                            DUP 9 ;
                                            GET 11 ;
                                            COMPARE ;
                                            EQ ;
                                            IF { DROP 9 ; PUSH nat 121 ; FAILWITH }
                                               { NIL (pair address (list (pair address nat nat))) ;
                                                 NIL (pair address nat nat) ;
                                                 DUP 10 ;
                                                 GET 11 ;
                                                 DUP 11 ;
                                                 GET 3 ;
                                                 SELF_ADDRESS ;
                                                 PAIR 3 ;
                                                 CONS ;
                                                 SENDER ;
                                                 PAIR ;
                                                 CONS ;
                                                 DUP 9 ;
                                                 GET 13 ;
                                                 CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                                 IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                                 SWAP ;
                                                 MAP { DUP ;
                                                       CDR ;
                                                       MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                       SWAP ;
                                                       CAR ;
                                                       PAIR } ;
                                                 SWAP ;
                                                 PUSH mutez 0 ;
                                                 DIG 2 ;
                                                 TRANSFER_TOKENS ;
                                                 DUP 10 ;
                                                 GET 13 ;
                                                 DUP 10 ;
                                                 GET 20 ;
                                                 DUP 9 ;
                                                 DUP 12 ;
                                                 GET 20 ;
                                                 NOT ;
                                                 IF { EMPTY_SET string ; DIG 10 ; PUSH bool True ; SWAP ; UPDATE }
                                                    { DIG 9 ; DROP ; DUP 11 ; GET 19 } ;
                                                 DIG 5 ;
                                                 DUP 12 ;
                                                 GET 13 ;
                                                 DUP 13 ;
                                                 GET 11 ;
                                                 DUP 14 ;
                                                 GET 9 ;
                                                 DIG 11 ;
                                                 DUP 15 ;
                                                 GET 7 ;
                                                 DUP 16 ;
                                                 GET 5 ;
                                                 DIG 13 ;
                                                 DIG 13 ;
                                                 DIG 14 ;
                                                 DUP 17 ;
                                                 GET 3 ;
                                                 SENDER ;
                                                 PAIR 15 ;
                                                 SOME ;
                                                 DUP 4 ;
                                                 PAIR 3 ;
                                                 DUP 5 ;
                                                 GET 9 ;
                                                 DIG 3 ;
                                                 SOME ;
                                                 SENDER ;
                                                 DIG 5 ;
                                                 GET 3 ;
                                                 PAIR ;
                                                 PAIR 3 ;
                                                 DUP 4 ;
                                                 PUSH nat 1 ;
                                                 DIG 5 ;
                                                 GET 5 ;
                                                 ADD ;
                                                 UPDATE 5 ;
                                                 DIG 2 ;
                                                 UNPAIR 3 ;
                                                 UPDATE ;
                                                 UPDATE 13 ;
                                                 SWAP ;
                                                 UNPAIR 3 ;
                                                 UPDATE ;
                                                 UPDATE 9 ;
                                                 NIL operation ;
                                                 DIG 2 ;
                                                 CONS ;
                                                 PAIR } } } } } } }
                   { DIG 2 ;
                     DROP ;
                     IF_LEFT
                       { IF_LEFT
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 3 ; PUSH nat 117 ; FAILWITH }
                                { PUSH mutez 0 ;
                                  AMOUNT ;
                                  COMPARE ;
                                  NEQ ;
                                  PUSH string "XTZ" ;
                                  DUP 3 ;
                                  GET 5 ;
                                  COMPARE ;
                                  EQ ;
                                  NOT ;
                                  AND ;
                                  IF { DROP 3 ; PUSH nat 133 ; FAILWITH }
                                     { DUP 2 ;
                                       GET 13 ;
                                       DUP 2 ;
                                       CAR ;
                                       GET ;
                                       IF_NONE { PUSH nat 103 ; FAILWITH } {} ;
                                       DUP ;
                                       GET 23 ;
                                       SENDER ;
                                       COMPARE ;
                                       NEQ ;
                                       DUP 2 ;
                                       GET 7 ;
                                       AND ;
                                       IF { PUSH nat 128 ; FAILWITH } { SENDER } ;
                                       DUP 2 ;
                                       GET 13 ;
                                       NOW ;
                                       COMPARE ;
                                       LT ;
                                       IF { DROP 5 ; PUSH nat 109 ; FAILWITH }
                                          { DUP 2 ;
                                            GET 17 ;
                                            NOW ;
                                            COMPARE ;
                                            GT ;
                                            IF { DROP 5 ; PUSH nat 110 ; FAILWITH }
                                               { PUSH nat 0 ;
                                                 DUP 3 ;
                                                 GET 11 ;
                                                 COMPARE ;
                                                 EQ ;
                                                 IF { DIG 4 ;
                                                      DROP ;
                                                      NIL (pair address (list (pair address nat nat))) ;
                                                      NIL (pair address nat nat) ;
                                                      DUP 5 ;
                                                      GET 3 ;
                                                      DUP 5 ;
                                                      GET 3 ;
                                                      DIG 4 ;
                                                      PAIR 3 ;
                                                      CONS ;
                                                      SELF_ADDRESS ;
                                                      PAIR ;
                                                      CONS ;
                                                      DUP 2 ;
                                                      GET 21 ;
                                                      CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                                      IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                                      SWAP ;
                                                      MAP { DUP ;
                                                            CDR ;
                                                            MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                            SWAP ;
                                                            CAR ;
                                                            PAIR } ;
                                                      SWAP ;
                                                      PUSH mutez 0 ;
                                                      DIG 2 ;
                                                      TRANSFER_TOKENS ;
                                                      DUP 3 ;
                                                      GET 3 ;
                                                      DUP 3 ;
                                                      GET 19 ;
                                                      SUB ;
                                                      ISNAT ;
                                                      IF_NONE { PUSH nat 119 ; FAILWITH } {} ;
                                                      PUSH nat 0 ;
                                                      DUP 2 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { DROP ;
                                                           DUP 4 ;
                                                           GET 9 ;
                                                           NONE nat ;
                                                           DUP 4 ;
                                                           CAR ;
                                                           DIG 4 ;
                                                           GET 3 ;
                                                           PAIR ;
                                                           UPDATE ;
                                                           DUP 4 ;
                                                           GET 13 ;
                                                           NONE (pair address
                                                                      nat
                                                                      bool
                                                                      bool
                                                                      nat
                                                                      nat
                                                                      timestamp
                                                                      int
                                                                      timestamp
                                                                      nat
                                                                      address
                                                                      address
                                                                      (set string)
                                                                      string
                                                                      bool) ;
                                                           DIG 4 ;
                                                           CAR ;
                                                           UPDATE }
                                                         { DUP 5 ;
                                                           GET 9 ;
                                                           DUP 6 ;
                                                           GET 13 ;
                                                           DIG 4 ;
                                                           DIG 3 ;
                                                           UPDATE 19 ;
                                                           SOME ;
                                                           DIG 4 ;
                                                           CAR ;
                                                           UPDATE } ;
                                                      DIG 3 ;
                                                      SWAP ;
                                                      UPDATE 13 ;
                                                      SWAP ;
                                                      UPDATE 9 ;
                                                      NIL operation ;
                                                      DIG 2 ;
                                                      CONS }
                                                    { DUP 4 ;
                                                      CAR ;
                                                      DUP 3 ;
                                                      GET 21 ;
                                                      COMPARE ;
                                                      NEQ ;
                                                      IF { PUSH nat 0 ; SELF_ADDRESS ; PAIR }
                                                         { DUP 4 ;
                                                           GET 3 ;
                                                           DUP 3 ;
                                                           GET 3 ;
                                                           VIEW "get_royalties" (pair (address %issuer) (nat %royalties)) ;
                                                           IF_NONE { PUSH string "no royalties" ; FAILWITH } {} } ;
                                                      DUP 3 ;
                                                      GET 5 ;
                                                      IF { DUP 3 ;
                                                           GET 15 ;
                                                           DUP 4 ;
                                                           GET 11 ;
                                                           NOW ;
                                                           DUP 3 ;
                                                           DUP 7 ;
                                                           GET 13 ;
                                                           ADD ;
                                                           SUB ;
                                                           ISNAT ;
                                                           IF_NONE
                                                             { SWAP ; DROP }
                                                             { DUP 2 ;
                                                               DIG 3 ;
                                                               ABS ;
                                                               DIG 3 ;
                                                               DUP 7 ;
                                                               GET 9 ;
                                                               SUB ;
                                                               ABS ;
                                                               DIG 3 ;
                                                               MUL ;
                                                               EDIV ;
                                                               IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                               CAR ;
                                                               ADD } }
                                                         { DUP 3 ; GET 11 } ;
                                                      DUP 4 ;
                                                      GET 25 ;
                                                      DUP 6 ;
                                                      GET 5 ;
                                                      MEM ;
                                                      NOT ;
                                                      IF { PUSH nat 138 ; FAILWITH } {} ;
                                                      PUSH string "XTZ" ;
                                                      DUP 6 ;
                                                      GET 5 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { AMOUNT ;
                                                           PUSH mutez 1 ;
                                                           SWAP ;
                                                           EDIV ;
                                                           IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                           CAR }
                                                         { DUP 5 ; GET 6 } ;
                                                      DUP 5 ;
                                                      GET 28 ;
                                                      NOT ;
                                                      IF { DUP 5 ;
                                                           GET 27 ;
                                                           DUP 7 ;
                                                           GET 5 ;
                                                           COMPARE ;
                                                           NEQ ;
                                                           IF { SWAP ; DROP ; PUSH nat 148 ; FAILWITH } { SWAP } }
                                                         { DUP 5 ;
                                                           GET 27 ;
                                                           DUP 7 ;
                                                           GET 5 ;
                                                           COMPARE ;
                                                           EQ ;
                                                           IF { SWAP }
                                                              { DUP 6 ;
                                                                GET 5 ;
                                                                DUP 6 ;
                                                                GET 27 ;
                                                                DUP 2 ;
                                                                DUP 2 ;
                                                                COMPARE ;
                                                                EQ ;
                                                                IF { DROP 2 ; SWAP }
                                                                   { PUSH string "USD" ;
                                                                     DUP 3 ;
                                                                     COMPARE ;
                                                                     EQ ;
                                                                     IF { DUP 9 ;
                                                                          GET 23 ;
                                                                          DUG 2 ;
                                                                          PAIR ;
                                                                          GET ;
                                                                          IF_NONE
                                                                            { PUSH nat 136 ; FAILWITH }
                                                                            { PUSH string "" ; PUSH bool True ; DIG 2 ; PAIR ; PAIR } }
                                                                        { PUSH string "USD" ;
                                                                          DUP 2 ;
                                                                          COMPARE ;
                                                                          EQ ;
                                                                          IF { DUP 9 ;
                                                                               GET 23 ;
                                                                               SWAP ;
                                                                               DIG 2 ;
                                                                               PAIR ;
                                                                               GET ;
                                                                               IF_NONE
                                                                                 { PUSH nat 136 ; FAILWITH }
                                                                                 { PUSH string "" ; PUSH bool False ; DIG 2 ; PAIR ; PAIR } }
                                                                             { DUP 9 ;
                                                                               GET 23 ;
                                                                               PUSH string "USD" ;
                                                                               DIG 2 ;
                                                                               PAIR ;
                                                                               GET ;
                                                                               IF_NONE { PUSH nat 136 ; FAILWITH } {} ;
                                                                               DUP 9 ;
                                                                               GET 23 ;
                                                                               PUSH string "USD" ;
                                                                               DIG 3 ;
                                                                               PAIR ;
                                                                               GET ;
                                                                               IF_NONE { PUSH nat 136 ; FAILWITH } {} ;
                                                                               PUSH bool True ;
                                                                               DIG 2 ;
                                                                               PAIR ;
                                                                               PAIR } } ;
                                                                     UNPAIR ;
                                                                     UNPAIR ;
                                                                     PUSH nat 1000000 ;
                                                                     PUSH string "" ;
                                                                     DUP 5 ;
                                                                     COMPARE ;
                                                                     EQ ;
                                                                     IF { DIG 3 ;
                                                                          DROP ;
                                                                          DUP 10 ;
                                                                          GET 27 ;
                                                                          DIG 2 ;
                                                                          VIEW "getPrice" (pair timestamp nat) ;
                                                                          IF_NONE { PUSH nat 137 ; FAILWITH } {} ;
                                                                          CDR ;
                                                                          DIG 2 ;
                                                                          IF { DIG 3 ;
                                                                               MUL ;
                                                                               EDIV ;
                                                                               IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                                               CAR }
                                                                             { SWAP ;
                                                                               DIG 3 ;
                                                                               MUL ;
                                                                               EDIV ;
                                                                               IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                                               CAR } }
                                                                        { DIG 2 ;
                                                                          DROP 2 ;
                                                                          DUP 9 ;
                                                                          GET 27 ;
                                                                          SWAP ;
                                                                          VIEW "getPrice" (pair timestamp nat) ;
                                                                          IF_NONE { PUSH nat 137 ; FAILWITH } {} ;
                                                                          CDR ;
                                                                          DUP 9 ;
                                                                          GET 27 ;
                                                                          DIG 2 ;
                                                                          VIEW "getPrice" (pair timestamp nat) ;
                                                                          IF_NONE { PUSH nat 137 ; FAILWITH } {} ;
                                                                          CDR ;
                                                                          SWAP ;
                                                                          DIG 3 ;
                                                                          MUL ;
                                                                          EDIV ;
                                                                          IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                                          CAR } } } } ;
                                                      PUSH nat 114 ;
                                                      DIG 2 ;
                                                      DUP 7 ;
                                                      GET 3 ;
                                                      DUP 4 ;
                                                      MUL ;
                                                      COMPARE ;
                                                      LE ;
                                                      NOT ;
                                                      IF { FAILWITH } { DROP } ;
                                                      DUP 5 ;
                                                      GET 3 ;
                                                      DUP 5 ;
                                                      GET 19 ;
                                                      SUB ;
                                                      ISNAT ;
                                                      IF_NONE { PUSH nat 119 ; FAILWITH } {} ;
                                                      PUSH nat 10000 ;
                                                      DUP 8 ;
                                                      GET 17 ;
                                                      DUP 4 ;
                                                      MUL ;
                                                      EDIV ;
                                                      IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                      CAR ;
                                                      PUSH nat 10000 ;
                                                      DUP 4 ;
                                                      DUP 6 ;
                                                      CDR ;
                                                      MUL ;
                                                      EDIV ;
                                                      IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                      CAR ;
                                                      DUP ;
                                                      DUP 3 ;
                                                      ADD ;
                                                      DIG 4 ;
                                                      SUB ;
                                                      ISNAT ;
                                                      IF_NONE { PUSH nat 105 ; FAILWITH } {} ;
                                                      DUP 9 ;
                                                      GET 21 ;
                                                      DUP 9 ;
                                                      GET 5 ;
                                                      GET ;
                                                      IF_NONE { PUSH nat 139 ; FAILWITH } { CDR } ;
                                                      PUSH string "XTZ" ;
                                                      DUP 10 ;
                                                      GET 5 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { PUSH mutez 1 ;
                                                           DUP 3 ;
                                                           MUL ;
                                                           DUP 9 ;
                                                           CAR ;
                                                           CONTRACT unit ;
                                                           IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                           SWAP ;
                                                           UNIT ;
                                                           TRANSFER_TOKENS }
                                                         { DUP 2 ;
                                                           DUP 9 ;
                                                           CAR ;
                                                           SENDER ;
                                                           DUP 4 ;
                                                           PAIR 4 ;
                                                           UNPAIR 4 ;
                                                           CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                           IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                           PUSH mutez 0 ;
                                                           DIG 4 ;
                                                           DIG 4 ;
                                                           DIG 4 ;
                                                           PAIR 3 ;
                                                           TRANSFER_TOKENS } ;
                                                      NIL (pair address (list (pair address nat nat))) ;
                                                      NIL (pair address nat nat) ;
                                                      DUP 12 ;
                                                      GET 3 ;
                                                      DUP 12 ;
                                                      GET 3 ;
                                                      DIG 11 ;
                                                      PAIR 3 ;
                                                      CONS ;
                                                      SELF_ADDRESS ;
                                                      PAIR ;
                                                      CONS ;
                                                      DUP 9 ;
                                                      GET 21 ;
                                                      CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                                      IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                                      SWAP ;
                                                      MAP { DUP ;
                                                            CDR ;
                                                            MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                            SWAP ;
                                                            CAR ;
                                                            PAIR } ;
                                                      SWAP ;
                                                      PUSH mutez 0 ;
                                                      DIG 2 ;
                                                      TRANSFER_TOKENS ;
                                                      PUSH nat 0 ;
                                                      DUP 8 ;
                                                      COMPARE ;
                                                      EQ ;
                                                      IF { DIG 6 ;
                                                           DROP ;
                                                           DUP 10 ;
                                                           GET 9 ;
                                                           NONE nat ;
                                                           DUP 10 ;
                                                           CAR ;
                                                           DIG 10 ;
                                                           GET 3 ;
                                                           PAIR ;
                                                           UPDATE ;
                                                           DUP 10 ;
                                                           GET 13 ;
                                                           NONE (pair address
                                                                      nat
                                                                      bool
                                                                      bool
                                                                      nat
                                                                      nat
                                                                      timestamp
                                                                      int
                                                                      timestamp
                                                                      nat
                                                                      address
                                                                      address
                                                                      (set string)
                                                                      string
                                                                      bool) ;
                                                           DUP 11 ;
                                                           CAR ;
                                                           UPDATE }
                                                         { DUP 11 ;
                                                           GET 9 ;
                                                           DUP 12 ;
                                                           GET 13 ;
                                                           DIG 10 ;
                                                           DIG 9 ;
                                                           UPDATE 19 ;
                                                           SOME ;
                                                           DUP 11 ;
                                                           CAR ;
                                                           UPDATE } ;
                                                      DIG 8 ;
                                                      CAR ;
                                                      SENDER ;
                                                      DUP 7 ;
                                                      DUP 12 ;
                                                      GET 5 ;
                                                      DIG 10 ;
                                                      PUSH nat 0 ;
                                                      DIG 11 ;
                                                      COMPARE ;
                                                      GT ;
                                                      IF { NIL operation ; DIG 8 ; CONS } { DIG 8 ; DROP ; NIL operation } ;
                                                      DIG 8 ;
                                                      CONS ;
                                                      PAIR 6 ;
                                                      UNPAIR 6 ;
                                                      PUSH nat 0 ;
                                                      DUP 3 ;
                                                      COMPARE ;
                                                      GT ;
                                                      IF { PUSH string "XTZ" ;
                                                           DIG 3 ;
                                                           COMPARE ;
                                                           EQ ;
                                                           IF { DIG 2 ;
                                                                DIG 3 ;
                                                                DROP 2 ;
                                                                PUSH mutez 1 ;
                                                                DIG 2 ;
                                                                MUL ;
                                                                DIG 2 ;
                                                                CONTRACT unit ;
                                                                IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                                SWAP ;
                                                                UNIT ;
                                                                TRANSFER_TOKENS }
                                                              { DIG 2 ;
                                                                CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                                IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                                PUSH mutez 0 ;
                                                                DIG 3 ;
                                                                DIG 5 ;
                                                                DIG 5 ;
                                                                PAIR 3 ;
                                                                TRANSFER_TOKENS } ;
                                                           CONS }
                                                         { SWAP ; DIG 2 ; DIG 3 ; DIG 4 ; DIG 5 ; DROP 5 } ;
                                                      DUP 7 ;
                                                      GET 30 ;
                                                      SENDER ;
                                                      DIG 5 ;
                                                      DIG 7 ;
                                                      GET 5 ;
                                                      DIG 7 ;
                                                      DIG 5 ;
                                                      PAIR 6 ;
                                                      DIG 4 ;
                                                      SWAP ;
                                                      EXEC ;
                                                      DIG 3 ;
                                                      DIG 2 ;
                                                      UPDATE 13 ;
                                                      DIG 2 ;
                                                      UPDATE 9 ;
                                                      SWAP } ;
                                                 PAIR } } } } }
                           { DIG 2 ;
                             DROP ;
                             DUP 2 ;
                             GET 19 ;
                             IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                                { DUP ;
                                  GET 7 ;
                                  DUP 2 ;
                                  GET 5 ;
                                  COMPARE ;
                                  GE ;
                                  IF { DROP 2 ; PUSH nat 120 ; FAILWITH }
                                     { PUSH timestamp 0 ;
                                       DUP 2 ;
                                       GET 7 ;
                                       COMPARE ;
                                       EQ ;
                                       IF { DROP 2 ; PUSH nat 142 ; FAILWITH }
                                          { DUP ;
                                            GET 12 ;
                                            SENDER ;
                                            DUP 3 ;
                                            GET 3 ;
                                            DUP 4 ;
                                            CAR ;
                                            PAIR 4 ;
                                            DUP 3 ;
                                            GET 11 ;
                                            DUP 2 ;
                                            GET ;
                                            IF_NONE
                                              { DUP 2 ;
                                                GET 9 ;
                                                DUP 3 ;
                                                GET 5 ;
                                                SENDER ;
                                                PAIR ;
                                                DUP 4 ;
                                                GET 11 ;
                                                DUP 5 ;
                                                GET 7 ;
                                                PAIR ;
                                                PAIR ;
                                                PAIR }
                                              { DROP ; PUSH nat 147 ; FAILWITH } ;
                                            DUP 4 ;
                                            GET 15 ;
                                            DUP 4 ;
                                            GET 12 ;
                                            DUP 5 ;
                                            GET 3 ;
                                            DUP 6 ;
                                            CAR ;
                                            PAIR 3 ;
                                            GET ;
                                            IF_NONE { PUSH nat 116 ; FAILWITH } {} ;
                                            NIL (pair address (list (pair address nat nat))) ;
                                            NIL (pair address nat nat) ;
                                            DUP 3 ;
                                            CAR ;
                                            DIG 6 ;
                                            CAR ;
                                            SELF_ADDRESS ;
                                            PAIR 3 ;
                                            CONS ;
                                            SENDER ;
                                            PAIR ;
                                            CONS ;
                                            SWAP ;
                                            GET 9 ;
                                            CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                            IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                            SWAP ;
                                            MAP { DUP ;
                                                  CDR ;
                                                  MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                  SWAP ;
                                                  CAR ;
                                                  PAIR } ;
                                            SWAP ;
                                            PUSH mutez 0 ;
                                            DIG 2 ;
                                            TRANSFER_TOKENS ;
                                            DUP 4 ;
                                            DIG 4 ;
                                            GET 11 ;
                                            DIG 3 ;
                                            SOME ;
                                            DIG 4 ;
                                            UPDATE ;
                                            UPDATE 11 ;
                                            NIL operation ;
                                            DIG 2 ;
                                            CONS ;
                                            PAIR } } } } }
                       { DIG 2 ;
                         DROP ;
                         IF_LEFT
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                                { UNPAIR 4 ;
                                  PUSH nat 2500 ;
                                  DUP 3 ;
                                  COMPARE ;
                                  GT ;
                                  IF { DROP 5 ; PUSH nat 108 ; FAILWITH }
                                     { EMPTY_MAP string bytes ;
                                       SWAP ;
                                       PACK ;
                                       SOME ;
                                       PUSH string "" ;
                                       UPDATE ;
                                       DUP 5 ;
                                       GET 7 ;
                                       DUP 6 ;
                                       CAR ;
                                       CONTRACT %mint
                                         (pair (nat %token_id)
                                               (map %token_metadata string bytes)
                                               (nat %amount_)
                                               (address %owner)) ;
                                       IF_NONE { PUSH nat 102 ; FAILWITH } {} ;
                                       PUSH mutez 0 ;
                                       DIG 6 ;
                                       DIG 6 ;
                                       DIG 5 ;
                                       DUP 6 ;
                                       PAIR 4 ;
                                       TRANSFER_TOKENS ;
                                       DUP 4 ;
                                       GET 3 ;
                                       CONTRACT %configRoyalties
                                         (pair (nat %token_id) (address %token_origin) (nat %royalties)) ;
                                       IF_NONE { PUSH nat 123 ; FAILWITH } {} ;
                                       PUSH mutez 0 ;
                                       DIG 4 ;
                                       DUP 6 ;
                                       CAR ;
                                       DIG 5 ;
                                       PAIR 3 ;
                                       TRANSFER_TOKENS ;
                                       DUP 3 ;
                                       PUSH nat 1 ;
                                       DIG 4 ;
                                       GET 7 ;
                                       ADD ;
                                       UPDATE 7 ;
                                       NIL operation ;
                                       DIG 2 ;
                                       CONS ;
                                       DIG 2 ;
                                       CONS ;
                                       PAIR } } }
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                                { DUP 2 ;
                                  GET 13 ;
                                  DUP 2 ;
                                  GET ;
                                  IF_NONE { PUSH nat 103 ; FAILWITH } {} ;
                                  DUP ;
                                  CAR ;
                                  SENDER ;
                                  COMPARE ;
                                  NEQ ;
                                  IF { DROP 3 ; PUSH nat 104 ; FAILWITH }
                                     { DUP ;
                                       GET 3 ;
                                       NIL (pair address (list (pair address nat nat))) ;
                                       NIL (pair address nat nat) ;
                                       DUP 4 ;
                                       GET 19 ;
                                       DUP 4 ;
                                       SENDER ;
                                       PAIR 3 ;
                                       CONS ;
                                       SELF_ADDRESS ;
                                       PAIR ;
                                       CONS ;
                                       DIG 2 ;
                                       GET 21 ;
                                       CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                       IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                       SWAP ;
                                       MAP { DUP ;
                                             CDR ;
                                             MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                             SWAP ;
                                             CAR ;
                                             PAIR } ;
                                       SWAP ;
                                       PUSH mutez 0 ;
                                       DIG 2 ;
                                       TRANSFER_TOKENS ;
                                       DUP 4 ;
                                       GET 9 ;
                                       NONE nat ;
                                       SENDER ;
                                       DIG 4 ;
                                       PAIR ;
                                       PAIR 3 ;
                                       UNPAIR 3 ;
                                       UPDATE ;
                                       DUP 4 ;
                                       GET 13 ;
                                       NONE (pair address
                                                  nat
                                                  bool
                                                  bool
                                                  nat
                                                  nat
                                                  timestamp
                                                  int
                                                  timestamp
                                                  nat
                                                  address
                                                  address
                                                  (set string)
                                                  string
                                                  bool) ;
                                       DIG 4 ;
                                       UPDATE ;
                                       DIG 3 ;
                                       SWAP ;
                                       UPDATE 13 ;
                                       SWAP ;
                                       UPDATE 9 ;
                                       NIL operation ;
                                       DIG 2 ;
                                       CONS ;
                                       PAIR } } } } } }
               { DIG 3 ;
                 DROP ;
                 IF_LEFT
                   { DIG 2 ;
                     DROP ;
                     IF_LEFT
                       { IF_LEFT
                           { DUP 2 ;
                             GET 29 ;
                             SENDER ;
                             COMPARE ;
                             NEQ ;
                             IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                                { DUP 2 ;
                                  DIG 2 ;
                                  GET 25 ;
                                  DIG 2 ;
                                  PUSH bool False ;
                                  SWAP ;
                                  UPDATE ;
                                  UPDATE 25 ;
                                  NIL operation ;
                                  PAIR } }
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                                { DUP ;
                                  GET 7 ;
                                  DUP 2 ;
                                  GET 5 ;
                                  COMPARE ;
                                  GT ;
                                  IF { DROP 2 ; PUSH nat 120 ; FAILWITH }
                                     { DUP ;
                                       GET 9 ;
                                       SENDER ;
                                       DUP 3 ;
                                       GET 3 ;
                                       PAIR 3 ;
                                       DUP 3 ;
                                       GET 15 ;
                                       DUP 2 ;
                                       GET ;
                                       IF_NONE
                                         { PUSH string "XTZ" ;
                                           DUP 3 ;
                                           GET 11 ;
                                           COMPARE ;
                                           EQ ;
                                           IF { AMOUNT ;
                                                PUSH mutez 1 ;
                                                SWAP ;
                                                EDIV ;
                                                IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                CAR ;
                                                DUP 3 ;
                                                GET 12 ;
                                                COMPARE ;
                                                NEQ ;
                                                IF { PUSH nat 140 ; FAILWITH }
                                                   { AMOUNT ;
                                                     PUSH mutez 1 ;
                                                     SWAP ;
                                                     EDIV ;
                                                     IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                     CAR } }
                                              { DUP 2 ; GET 12 } ;
                                           PUSH string "XTZ" ;
                                           DUP 4 ;
                                           GET 11 ;
                                           COMPARE ;
                                           EQ ;
                                           IF { NIL operation }
                                              { DUP 4 ;
                                                GET 21 ;
                                                DUP 4 ;
                                                GET 11 ;
                                                GET ;
                                                IF_NONE
                                                  { PUSH nat 131 ; FAILWITH }
                                                  { NIL operation ;
                                                    DUP 3 ;
                                                    SELF_ADDRESS ;
                                                    SENDER ;
                                                    DIG 4 ;
                                                    CDR ;
                                                    PAIR 4 ;
                                                    UNPAIR 4 ;
                                                    CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                    IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                    PUSH mutez 0 ;
                                                    DIG 4 ;
                                                    DIG 4 ;
                                                    DIG 4 ;
                                                    PAIR 3 ;
                                                    TRANSFER_TOKENS ;
                                                    CONS } } ;
                                           DUP 5 ;
                                           DIG 5 ;
                                           GET 15 ;
                                           DUP 6 ;
                                           GET 11 ;
                                           DUP 7 ;
                                           GET 9 ;
                                           DUP 8 ;
                                           GET 7 ;
                                           DUP 9 ;
                                           GET 5 ;
                                           DIG 7 ;
                                           DIG 9 ;
                                           CAR ;
                                           PAIR 6 ;
                                           SOME ;
                                           DIG 4 ;
                                           UPDATE ;
                                           UPDATE 15 ;
                                           SWAP ;
                                           PAIR }
                                         { DROP 4 ; PUSH nat 115 ; FAILWITH } } } } }
                       { IF_LEFT
                           { DUP 2 ;
                             GET 29 ;
                             SENDER ;
                             COMPARE ;
                             NEQ ;
                             IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                                { UPDATE 29 ; NIL operation ; PAIR } }
                           { DUP 2 ;
                             GET 29 ;
                             SENDER ;
                             COMPARE ;
                             NEQ ;
                             IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                                { DUP ;
                                  CDR ;
                                  IF_LEFT
                                    { DUP 3 ;
                                      GET 21 ;
                                      DUP 3 ;
                                      CAR ;
                                      MEM ;
                                      IF { DROP 3 ; PUSH nat 145 ; FAILWITH }
                                         { DUP 3 ;
                                           GET 23 ;
                                           PUSH string "USD" ;
                                           DUP 4 ;
                                           CAR ;
                                           PAIR ;
                                           MEM ;
                                           IF { DROP 3 ; PUSH nat 146 ; FAILWITH }
                                              { DUP 3 ;
                                                DUP 4 ;
                                                GET 21 ;
                                                DIG 2 ;
                                                DUP 4 ;
                                                CAR ;
                                                PAIR ;
                                                SOME ;
                                                DUP 4 ;
                                                CAR ;
                                                UPDATE ;
                                                UPDATE 21 ;
                                                DIG 2 ;
                                                GET 23 ;
                                                PUSH string "-USD" ;
                                                DUP 4 ;
                                                CAR ;
                                                CONCAT ;
                                                SOME ;
                                                PUSH string "USD" ;
                                                DIG 4 ;
                                                CAR ;
                                                PAIR ;
                                                UPDATE ;
                                                UPDATE 23 ;
                                                NIL operation ;
                                                PAIR } } }
                                    { DROP ;
                                      DUP 2 ;
                                      DUP 3 ;
                                      GET 21 ;
                                      NONE (pair string address) ;
                                      DUP 4 ;
                                      CAR ;
                                      UPDATE ;
                                      UPDATE 21 ;
                                      DIG 2 ;
                                      GET 23 ;
                                      NONE string ;
                                      PUSH string "USD" ;
                                      DIG 4 ;
                                      CAR ;
                                      PAIR ;
                                      UPDATE ;
                                      UPDATE 23 ;
                                      NIL operation ;
                                      PAIR } } } } }
                   { IF_LEFT
                       { DIG 2 ;
                         DROP ;
                         IF_LEFT
                           { DUP 2 ;
                             GET 29 ;
                             SENDER ;
                             COMPARE ;
                             NEQ ;
                             IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                                { UPDATE 17 ; NIL operation ; PAIR } }
                           { DUP 2 ;
                             GET 29 ;
                             SENDER ;
                             COMPARE ;
                             NEQ ;
                             IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                                { UPDATE 1 ; NIL operation ; PAIR } } }
                       { IF_LEFT
                           { DUP 2 ;
                             GET 19 ;
                             IF { DROP 3 ; PUSH nat 117 ; FAILWITH }
                                { PUSH mutez 0 ;
                                  AMOUNT ;
                                  COMPARE ;
                                  NEQ ;
                                  PUSH string "XTZ" ;
                                  DUP 3 ;
                                  GET 11 ;
                                  COMPARE ;
                                  EQ ;
                                  NOT ;
                                  AND ;
                                  IF { DROP 3 ; PUSH nat 133 ; FAILWITH }
                                     { DUP ;
                                       GET 7 ;
                                       DUP 2 ;
                                       GET 5 ;
                                       COMPARE ;
                                       GT ;
                                       IF { DROP 3 ; PUSH nat 120 ; FAILWITH }
                                          { DUP ;
                                            GET 9 ;
                                            SENDER ;
                                            DUP 3 ;
                                            GET 3 ;
                                            PAIR 3 ;
                                            DUP 3 ;
                                            GET 15 ;
                                            DUP 2 ;
                                            GET ;
                                            IF_NONE
                                              { DROP 4 ; PUSH nat 116 ; FAILWITH }
                                              { DUP ;
                                                GET 10 ;
                                                DUP 4 ;
                                                GET 11 ;
                                                COMPARE ;
                                                EQ ;
                                                IF { PUSH string "XTZ" ;
                                                     DUP 4 ;
                                                     GET 11 ;
                                                     COMPARE ;
                                                     EQ ;
                                                     IF { DIG 4 ;
                                                          DROP ;
                                                          DUP 3 ;
                                                          GET 12 ;
                                                          AMOUNT ;
                                                          PUSH mutez 1 ;
                                                          SWAP ;
                                                          EDIV ;
                                                          IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                                          CAR ;
                                                          COMPARE ;
                                                          NEQ ;
                                                          IF { PUSH nat 140 ; FAILWITH }
                                                             { NIL operation ;
                                                               PUSH mutez 1 ;
                                                               DUP 3 ;
                                                               GET 3 ;
                                                               MUL ;
                                                               SENDER ;
                                                               CONTRACT unit ;
                                                               IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                               SWAP ;
                                                               UNIT ;
                                                               TRANSFER_TOKENS ;
                                                               CONS } }
                                                        { DUP 4 ;
                                                          DUP 4 ;
                                                          GET 11 ;
                                                          PAIR ;
                                                          DIG 5 ;
                                                          SWAP ;
                                                          EXEC ;
                                                          DUP 2 ;
                                                          GET 3 ;
                                                          DUP 5 ;
                                                          GET 12 ;
                                                          SUB ;
                                                          ISNAT ;
                                                          IF_NONE
                                                            { NIL operation ;
                                                              DUP 3 ;
                                                              GET 3 ;
                                                              DUP 6 ;
                                                              GET 12 ;
                                                              SUB ;
                                                              ABS ;
                                                              SENDER ;
                                                              SELF_ADDRESS ;
                                                              DIG 4 ;
                                                              PAIR 4 ;
                                                              UNPAIR 4 ;
                                                              CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                              IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                              PUSH mutez 0 ;
                                                              DIG 4 ;
                                                              DIG 4 ;
                                                              DIG 4 ;
                                                              PAIR 3 ;
                                                              TRANSFER_TOKENS ;
                                                              CONS }
                                                            { PUSH nat 0 ;
                                                              DUP 2 ;
                                                              COMPARE ;
                                                              NEQ ;
                                                              IF { NIL operation ;
                                                                   SWAP ;
                                                                   SELF_ADDRESS ;
                                                                   SENDER ;
                                                                   DIG 4 ;
                                                                   PAIR 4 ;
                                                                   UNPAIR 4 ;
                                                                   CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                                   IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                                   PUSH mutez 0 ;
                                                                   DIG 4 ;
                                                                   DIG 4 ;
                                                                   DIG 4 ;
                                                                   PAIR 3 ;
                                                                   TRANSFER_TOKENS ;
                                                                   CONS }
                                                                 { DROP 2 ; NIL operation } } } }
                                                   { DUP 4 ;
                                                     DUP 2 ;
                                                     GET 10 ;
                                                     PAIR ;
                                                     DUP 6 ;
                                                     SWAP ;
                                                     EXEC ;
                                                     DUP 5 ;
                                                     DUP 5 ;
                                                     GET 11 ;
                                                     PAIR ;
                                                     DIG 6 ;
                                                     SWAP ;
                                                     EXEC ;
                                                     PUSH string "XTZ" ;
                                                     DUP 6 ;
                                                     GET 11 ;
                                                     COMPARE ;
                                                     EQ ;
                                                     IF { DROP ;
                                                          NIL operation ;
                                                          DUP 3 ;
                                                          GET 3 ;
                                                          SENDER ;
                                                          SELF_ADDRESS ;
                                                          DIG 4 ;
                                                          PAIR 4 ;
                                                          UNPAIR 4 ;
                                                          CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                          IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                          PUSH mutez 0 ;
                                                          DIG 4 ;
                                                          DIG 4 ;
                                                          DIG 4 ;
                                                          PAIR 3 ;
                                                          TRANSFER_TOKENS }
                                                        { PUSH string "XTZ" ;
                                                          DUP 4 ;
                                                          GET 10 ;
                                                          COMPARE ;
                                                          EQ ;
                                                          IF { SWAP ;
                                                               DROP ;
                                                               NIL operation ;
                                                               PUSH mutez 1 ;
                                                               DUP 4 ;
                                                               GET 3 ;
                                                               MUL ;
                                                               SENDER ;
                                                               CONTRACT unit ;
                                                               IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                                                               SWAP ;
                                                               UNIT ;
                                                               TRANSFER_TOKENS ;
                                                               CONS ;
                                                               DUP 5 ;
                                                               GET 12 ;
                                                               SELF_ADDRESS ;
                                                               SENDER ;
                                                               DIG 4 ;
                                                               PAIR 4 ;
                                                               UNPAIR 4 ;
                                                               CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                               IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                               PUSH mutez 0 ;
                                                               DIG 4 ;
                                                               DIG 4 ;
                                                               DIG 4 ;
                                                               PAIR 3 ;
                                                               TRANSFER_TOKENS }
                                                             { DUP 3 ;
                                                               GET 3 ;
                                                               SENDER ;
                                                               SELF_ADDRESS ;
                                                               DIG 4 ;
                                                               PAIR 4 ;
                                                               UNPAIR 4 ;
                                                               CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                               IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                               PUSH mutez 0 ;
                                                               DIG 4 ;
                                                               DIG 4 ;
                                                               DIG 4 ;
                                                               PAIR 3 ;
                                                               TRANSFER_TOKENS ;
                                                               DUP 5 ;
                                                               GET 12 ;
                                                               SELF_ADDRESS ;
                                                               SENDER ;
                                                               DIG 4 ;
                                                               PAIR 4 ;
                                                               UNPAIR 4 ;
                                                               CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                                                               IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                                                               PUSH mutez 0 ;
                                                               DIG 4 ;
                                                               DIG 4 ;
                                                               DIG 4 ;
                                                               PAIR 3 ;
                                                               TRANSFER_TOKENS ;
                                                               NIL operation ;
                                                               SWAP ;
                                                               CONS ;
                                                               SWAP } } ;
                                                     CONS } ;
                                                DUP 5 ;
                                                DIG 5 ;
                                                GET 15 ;
                                                DIG 3 ;
                                                DUP 6 ;
                                                CAR ;
                                                UPDATE 1 ;
                                                DUP 6 ;
                                                GET 12 ;
                                                UPDATE 3 ;
                                                DUP 6 ;
                                                GET 5 ;
                                                UPDATE 5 ;
                                                DUP 6 ;
                                                GET 7 ;
                                                UPDATE 7 ;
                                                DUP 6 ;
                                                GET 9 ;
                                                UPDATE 9 ;
                                                DIG 5 ;
                                                GET 11 ;
                                                UPDATE 10 ;
                                                SOME ;
                                                DIG 4 ;
                                                UPDATE ;
                                                UPDATE 15 ;
                                                SWAP ;
                                                PAIR } } } } }
                           { DIG 2 ;
                             DROP ;
                             DUP 2 ;
                             GET 29 ;
                             SENDER ;
                             COMPARE ;
                             NEQ ;
                             IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                                { UPDATE 27 ; NIL operation ; PAIR } } } } } }
           { DIG 2 ;
             DIG 3 ;
             DROP 2 ;
             IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { DUP 2 ;
                         NIL operation ;
                         DIG 3 ;
                         GET 3 ;
                         CONTRACT %configRoyalties
                           (pair (nat %token_id) (address %token_origin) (nat %royalties)) ;
                         IF_NONE { PUSH nat 123 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         DIG 4 ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         PAIR }
                       { DUP 2 ;
                         GET 29 ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { DROP 2 ; PUSH string "not admin" ; FAILWITH }
                            { UPDATE 3 ; NIL operation ; PAIR } } }
                   { IF_LEFT
                       { DUP 2 ;
                         GET 19 ;
                         IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                            { DUP 2 ;
                              GET 13 ;
                              DUP 2 ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH nat 103 ; FAILWITH } {} ;
                              DUP ;
                              CAR ;
                              SENDER ;
                              COMPARE ;
                              NEQ ;
                              IF { DROP 3 ; PUSH nat 122 ; FAILWITH }
                                 { DUP 2 ;
                                   CDR ;
                                   IF_LEFT
                                     { IF_LEFT
                                         { IF_LEFT
                                             { PUSH nat 0 ;
                                               DUP 2 ;
                                               COMPARE ;
                                               EQ ;
                                               IF { DROP 4 ; PUSH nat 121 ; FAILWITH }
                                                  { DUP 2 ;
                                                    GET 13 ;
                                                    NOW ;
                                                    COMPARE ;
                                                    GE ;
                                                    DUP 3 ;
                                                    GET 5 ;
                                                    AND ;
                                                    IF { DROP 4 ; PUSH nat 126 ; FAILWITH }
                                                       { NIL (pair address (list (pair address nat nat))) ;
                                                         NIL (pair address nat nat) ;
                                                         DUP 3 ;
                                                         DUP 5 ;
                                                         GET 3 ;
                                                         SELF_ADDRESS ;
                                                         PAIR 3 ;
                                                         CONS ;
                                                         SENDER ;
                                                         PAIR ;
                                                         CONS ;
                                                         DUP 3 ;
                                                         GET 21 ;
                                                         CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                                         IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                                         SWAP ;
                                                         MAP { DUP ;
                                                               CDR ;
                                                               MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                               SWAP ;
                                                               CAR ;
                                                               PAIR } ;
                                                         SWAP ;
                                                         PUSH mutez 0 ;
                                                         DIG 2 ;
                                                         TRANSFER_TOKENS ;
                                                         DUP 5 ;
                                                         GET 13 ;
                                                         DUP 4 ;
                                                         DIG 3 ;
                                                         DIG 4 ;
                                                         GET 19 ;
                                                         ADD ;
                                                         UPDATE 19 ;
                                                         SOME ;
                                                         DIG 3 ;
                                                         CAR ;
                                                         PAIR 3 ;
                                                         DIG 2 ;
                                                         SWAP ;
                                                         UNPAIR 3 ;
                                                         UPDATE ;
                                                         UPDATE 13 ;
                                                         NIL operation ;
                                                         DIG 2 ;
                                                         CONS ;
                                                         PAIR } } }
                                             { PUSH nat 0 ;
                                               DUP 2 ;
                                               COMPARE ;
                                               EQ ;
                                               IF { DROP 4 ; PUSH nat 121 ; FAILWITH }
                                                  { DUP 2 ;
                                                    GET 13 ;
                                                    NOW ;
                                                    COMPARE ;
                                                    GE ;
                                                    DUP 3 ;
                                                    GET 5 ;
                                                    AND ;
                                                    IF { DROP 4 ; PUSH nat 126 ; FAILWITH }
                                                       { DUP ;
                                                         DUP 3 ;
                                                         GET 19 ;
                                                         SUB ;
                                                         ISNAT ;
                                                         IF_NONE { PUSH nat 119 ; FAILWITH } {} ;
                                                         NIL (pair address (list (pair address nat nat))) ;
                                                         NIL (pair address nat nat) ;
                                                         DIG 3 ;
                                                         DUP 5 ;
                                                         GET 3 ;
                                                         SENDER ;
                                                         PAIR 3 ;
                                                         CONS ;
                                                         SELF_ADDRESS ;
                                                         PAIR ;
                                                         CONS ;
                                                         DUP 3 ;
                                                         GET 21 ;
                                                         CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                                         IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                                         SWAP ;
                                                         MAP { DUP ;
                                                               CDR ;
                                                               MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                                               SWAP ;
                                                               CAR ;
                                                               PAIR } ;
                                                         SWAP ;
                                                         PUSH mutez 0 ;
                                                         DIG 2 ;
                                                         TRANSFER_TOKENS ;
                                                         PUSH nat 0 ;
                                                         DUP 3 ;
                                                         COMPARE ;
                                                         NEQ ;
                                                         IF { DUP 5 ;
                                                              GET 9 ;
                                                              DUP 6 ;
                                                              GET 13 ;
                                                              DIG 4 ;
                                                              DIG 4 ;
                                                              UPDATE 19 ;
                                                              SOME ;
                                                              DIG 4 ;
                                                              CAR ;
                                                              UPDATE }
                                                            { SWAP ;
                                                              DROP ;
                                                              DUP 4 ;
                                                              GET 9 ;
                                                              NONE nat ;
                                                              SENDER ;
                                                              DIG 4 ;
                                                              GET 3 ;
                                                              PAIR ;
                                                              PAIR 3 ;
                                                              UNPAIR 3 ;
                                                              UPDATE ;
                                                              DUP 4 ;
                                                              GET 13 ;
                                                              NONE (pair address
                                                                         nat
                                                                         bool
                                                                         bool
                                                                         nat
                                                                         nat
                                                                         timestamp
                                                                         int
                                                                         timestamp
                                                                         nat
                                                                         address
                                                                         address
                                                                         (set string)
                                                                         string
                                                                         bool) ;
                                                              DIG 4 ;
                                                              CAR ;
                                                              UPDATE } ;
                                                         DIG 3 ;
                                                         SWAP ;
                                                         UPDATE 13 ;
                                                         SWAP ;
                                                         UPDATE 9 ;
                                                         NIL operation ;
                                                         DIG 2 ;
                                                         CONS ;
                                                         PAIR } } } }
                                         { IF_LEFT
                                             { DUP 2 ;
                                               GET 13 ;
                                               NOW ;
                                               COMPARE ;
                                               GE ;
                                               DUP 3 ;
                                               GET 5 ;
                                               AND ;
                                               PUSH bool False ;
                                               DUP 4 ;
                                               GET 5 ;
                                               COMPARE ;
                                               EQ ;
                                               OR ;
                                               IF { DROP 4 ; PUSH nat 129 ; FAILWITH }
                                                  { DUP 4 ;
                                                    GET 13 ;
                                                    DUG 2 ;
                                                    INT ;
                                                    UPDATE 15 ;
                                                    SOME ;
                                                    DIG 2 ;
                                                    CAR ;
                                                    PAIR 3 ;
                                                    UNPAIR 3 ;
                                                    UPDATE ;
                                                    UPDATE 13 ;
                                                    NIL operation ;
                                                    PAIR } }
                                             { DUP 2 ;
                                               GET 13 ;
                                               NOW ;
                                               COMPARE ;
                                               GE ;
                                               DUP 3 ;
                                               GET 5 ;
                                               AND ;
                                               IF { DROP 4 ; PUSH nat 126 ; FAILWITH }
                                                  { DUP 4 ;
                                                    DIG 4 ;
                                                    GET 13 ;
                                                    DIG 3 ;
                                                    DIG 3 ;
                                                    UPDATE 11 ;
                                                    SOME ;
                                                    DIG 3 ;
                                                    CAR ;
                                                    UPDATE ;
                                                    UPDATE 13 ;
                                                    NIL operation ;
                                                    PAIR } } } }
                                     { IF_LEFT
                                         { IF_LEFT
                                             { DUP 4 ;
                                               DIG 4 ;
                                               GET 13 ;
                                               DIG 3 ;
                                               DIG 3 ;
                                               UPDATE 23 ;
                                               PUSH bool True ;
                                               UPDATE 7 ;
                                               SOME ;
                                               DIG 3 ;
                                               CAR ;
                                               UPDATE ;
                                               UPDATE 13 ;
                                               NIL operation ;
                                               PAIR }
                                             { DUP 2 ;
                                               GET 13 ;
                                               NOW ;
                                               COMPARE ;
                                               GE ;
                                               DUP 3 ;
                                               GET 5 ;
                                               AND ;
                                               PUSH bool False ;
                                               DUP 4 ;
                                               GET 5 ;
                                               COMPARE ;
                                               EQ ;
                                               OR ;
                                               IF { DROP 4 ; PUSH nat 130 ; FAILWITH }
                                                  { DUP 4 ;
                                                    DIG 4 ;
                                                    GET 13 ;
                                                    DIG 3 ;
                                                    DIG 3 ;
                                                    UPDATE 9 ;
                                                    SOME ;
                                                    DIG 3 ;
                                                    CAR ;
                                                    UPDATE ;
                                                    UPDATE 13 ;
                                                    NIL operation ;
                                                    PAIR } } }
                                         { DUP ;
                                           CDR ;
                                           DUP 2 ;
                                           CAR ;
                                           COMPARE ;
                                           GE ;
                                           IF { DROP 4 ; PUSH nat 120 ; FAILWITH }
                                              { DUP 2 ;
                                                GET 13 ;
                                                NOW ;
                                                COMPARE ;
                                                GE ;
                                                DUP 3 ;
                                                GET 5 ;
                                                AND ;
                                                IF { DROP 4 ; PUSH nat 126 ; FAILWITH }
                                                   { DUP 4 ;
                                                     DIG 4 ;
                                                     GET 13 ;
                                                     DIG 3 ;
                                                     DUP 4 ;
                                                     CAR ;
                                                     UPDATE 13 ;
                                                     DIG 3 ;
                                                     CDR ;
                                                     UPDATE 17 ;
                                                     SOME ;
                                                     DIG 3 ;
                                                     CAR ;
                                                     UPDATE ;
                                                     UPDATE 13 ;
                                                     NIL operation ;
                                                     PAIR } } } } } } }
                       { DUP 2 ;
                         GET 19 ;
                         IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                            { DUP ;
                              GET 4 ;
                              SENDER ;
                              DUP 3 ;
                              GET 3 ;
                              DUP 4 ;
                              CAR ;
                              PAIR 4 ;
                              DUP 3 ;
                              GET 15 ;
                              DUP 3 ;
                              GET ;
                              IF_NONE { PUSH nat 116 ; FAILWITH } {} ;
                              DUP 4 ;
                              GET 11 ;
                              DUP 3 ;
                              MEM ;
                              NOT ;
                              IF { DROP 4 ; PUSH nat 141 ; FAILWITH }
                                 { NIL (pair address (list (pair address nat nat))) ;
                                   NIL (pair address nat nat) ;
                                   DUP 3 ;
                                   CAR ;
                                   DIG 5 ;
                                   CAR ;
                                   SENDER ;
                                   PAIR 3 ;
                                   CONS ;
                                   SELF_ADDRESS ;
                                   PAIR ;
                                   CONS ;
                                   SWAP ;
                                   GET 9 ;
                                   CONTRACT %transfer (list (pair address (list (pair address nat nat)))) ;
                                   IF_NONE { PUSH nat 101 ; FAILWITH } {} ;
                                   SWAP ;
                                   MAP { DUP ;
                                         CDR ;
                                         MAP { DUP ; GET 4 ; DUP 2 ; GET 3 ; PAIR ; SWAP ; CAR ; PAIR } ;
                                         SWAP ;
                                         CAR ;
                                         PAIR } ;
                                   SWAP ;
                                   PUSH mutez 0 ;
                                   DIG 2 ;
                                   TRANSFER_TOKENS ;
                                   DUP 3 ;
                                   DIG 3 ;
                                   GET 11 ;
                                   NONE (pair (pair (pair timestamp nat) address timestamp) string) ;
                                   DIG 4 ;
                                   UPDATE ;
                                   UPDATE 11 ;
                                   NIL operation ;
                                   DIG 2 ;
                                   CONS ;
                                   PAIR } } } } }
               { DUP 2 ;
                 GET 19 ;
                 IF { DROP 2 ; PUSH nat 117 ; FAILWITH }
                    { DUP ;
                      CDR ;
                      SENDER ;
                      DIG 2 ;
                      CAR ;
                      PAIR 3 ;
                      DUP 2 ;
                      GET 15 ;
                      DUP 2 ;
                      GET ;
                      IF_NONE
                        { DROP 2 ; PUSH nat 116 ; FAILWITH }
                        { PUSH string "XTZ" ;
                          DUP 2 ;
                          GET 10 ;
                          COMPARE ;
                          EQ ;
                          IF { PUSH mutez 1 ;
                               SWAP ;
                               GET 3 ;
                               MUL ;
                               SENDER ;
                               CONTRACT unit ;
                               IF_NONE { PUSH nat 106 ; FAILWITH } {} ;
                               SWAP ;
                               UNIT ;
                               TRANSFER_TOKENS }
                             { DUP 3 ;
                               GET 21 ;
                               DUP 2 ;
                               GET 10 ;
                               GET ;
                               IF_NONE { PUSH nat 131 ; FAILWITH } { CDR } ;
                               SWAP ;
                               GET 3 ;
                               SENDER ;
                               SELF_ADDRESS ;
                               DIG 3 ;
                               PAIR 4 ;
                               UNPAIR 4 ;
                               CONTRACT %transfer (pair (address %from) (address %to) (nat %value)) ;
                               IF_NONE { PUSH nat 132 ; FAILWITH } {} ;
                               PUSH mutez 0 ;
                               DIG 4 ;
                               DIG 4 ;
                               DIG 4 ;
                               PAIR 3 ;
                               TRANSFER_TOKENS } ;
                          DUP 3 ;
                          DIG 3 ;
                          GET 15 ;
                          NONE (pair nat nat timestamp timestamp address string) ;
                          DIG 4 ;
                          UPDATE ;
                          UPDATE 15 ;
                          NIL operation ;
                          DIG 2 ;
                          CONS ;
                          PAIR } } } } } }

